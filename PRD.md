# ParkRelief — 可攜式長者按摩墊應用

## 專案概述

**ParkRelief** 是一個純前端 Web 應用，配合可攜式按摩墊硬體，為高齡者提供隨時隨地的疼痛緩解方案。使用者能快速啟動按摩、記錄疼痛狀況，並透過 GUN.js 去中心化資料庫與家人或照護者同步資訊。

---

## 1. 目標族群

### 族群描述
- **主要客戶**: 65 歲以上高齡者，常有腰酸背痛或肌肉僵硬問題
- **次要客戶**: 高齡者的家人或照護者（醫護人員、子女等）

### 族群特質
- 行動能力較弱但仍喜歡參與戶外社交活動（例如在公園聊天）
- 習慣帶輕便、必需物品
- 對簡單直覺的操作有需求
- 可能對智慧型手機操作較不熟悉，但願意學習簡單按鈕或大圖示介面
- 健康紀錄對其本人與照護者都很重要（便於醫護人員參考）

---

## 2. 使用場景與痛點

### 典型情境
使用者在公園與朋友聊天時，忽然感到下背或肩頸劇烈疼痛，想立即緩解。

### 核心痛點
1. **無法即刻獲得支撐**: 周遭無現成療具、按摩服務或醫護人員
2. **環境限制**: 公園等戶外環境無電源，需要可攜帶且即放即用的解決方案
3. **資訊孤立**: 無法便捷地記錄症狀或通知家人與照護者
4. **操作複雜性**: 如有電子輔助裝置，控制介面應簡單明快，避免繁複步驟

---

## 3. 產品說明

### 硬體組件（非本次開發範圍，但預留擴充點）
- **可攜式按摩墊**: 輕便、可折疊、放在任何平面（椅子、地板、靠背）上即可使用
- **電源**: 內置或可充電（預期使用時間 3-5 小時以上）
- **無線連接**: 支援藍牙或 WebBluetooth（未來整合）

### 軟體（Web 應用）

**主要功能：**

1. **產品介紹頁面**
   - 簡潔展示產品用途、基本操作說明
   - 大字體、高對比度設計（便於高齡者閱讀）

2. **快速啟動**
   - 單按鈕「開始按摩」功能
   - 預設或自訂模式選擇（背部、腰部、肩頸）
   - 強度選擇（低、中、高）
   - 即時倒數計時與狀態顯示（「按摩中」/ 「已停止」）

3. **事件記錄與同步**
   - 記錄每次按摩事件（時間、部位、強度、備註、同步狀態）
   - 使用 GUN.js 儲存到去中心化資料庫
   - 顯示同步狀態（「同步中」/ 「同步成功」/ 「同步失敗」）

4. **分享給家人/照護者**
   - 簡單分享機制：產生並複製 GUN 資料鏈接
   - 家人可以同個連結打開網站，即時看到最新按摩紀錄
   - 不需要帳號登入或複雜授權

### 技術呈現
- **跨平台**: 純 HTML/CSS/JS，使用 CDN 套件（無後端、無打包工具）
- **適配性**: 支援桌面瀏覽器與行動瀏覽器
- **離線友善**: 核心功能可離線操作（連線時同步資料到 GUN）

---

## 4. 使用者故事

### Story 1: 高齡者緊急緩解疼痛
**作為** 在公園聊天的高齡者  
**我想要** 快速啟動按摩、選擇痛點部位  
**以便** 立即得到肌肉放鬆、疼痛緩解

**驗收條件：**
- [ ] 打開網頁後，看到清晰的「開始按摩」按鈕
- [ ] 按下按鈕後，能簡單選擇「腰部」、「背部」或「肩頸」
- [ ] 再選擇強度（低/中/高）
- [ ] 確認後裝置開始工作，頁面顯示「按摩中」與倒數計時
- [ ] 時間結束或按「停止」後狀態變為「已停止」

---

### Story 2: 照護者監控高齡者健康
**作為** 高齡者的子女或護理人員  
**我想要** 看到近期按摩紀錄與疼痛趨勢  
**以便** 評估是否需要進一步醫療介入

**驗收條件：**
- [ ] 高齡者分享的 GUN 連結可直接開啟
- [ ] 頁面即時顯示最新的按摩事件（時間、部位、強度、備註）
- [ ] 能看到同步狀態（最後同步時間）
- [ ] 新事件出現時自動更新（不需手動刷新，若 GUN 連線有效）

---

### Story 3: 測試者/開發者驗證核心功能
**作為** 開發者或 QA 人員  
**我想要** 在瀏覽器執行自動化測試  
**以便** 驗證儲存、讀取、UI 邏輯的正確性

**驗收條件：**
- [ ] 開啟 `tests.html`，看到 Mocha 測試套件
- [ ] 至少 3 個測試執行並通過
- [ ] 測試涵蓋：事件物件建立、GUN 同步、UI 狀態切換

---

## 5. 功能列表 (MVP)

### 核心功能
| # | 功能 | 優先級 | 描述 |
|---|------|--------|------|
| 1 | 產品介紹卡 | P0 | 首頁展示 ParkRelief 用途、基本操作說明 |
| 2 | 啟動/停止按摩 | P0 | 大按鈕，啟動後顯示「按摩中」與倒數，支援手動停止 |
| 3 | 部位選擇 | P0 | 選擇「腰部」/「背部」/「肩頸」 |
| 4 | 強度選擇 | P0 | 選擇「低」/「中」/「高」 |
| 5 | 狀態顯示 | P0 | 實時顯示「未啟動」/「按摩中」/「已停止」與倒數 |
| 6 | 事件建立 | P0 | 按摩結束時自動建立事件物件，含時間、部位、強度、備註欄位 |
| 7 | GUN 儲存與同步 | P0 | 將事件寫入 GUN 去中心化資料庫，顯示同步狀態 |
| 8 | 歷史紀錄顯示 | P1 | 列表展示過去的按摩事件 |
| 9 | 分享連結 | P0 | 生成可分享的 GUN 節點 URL，家人可點擊查看 |
| 10 | 瀏覽器單元測試 | P0 | 使用 Mocha + Chai CDN 實作自動化測試 |

---

## 6. 驗收準則

### 功能驗收
- [ ] **UI 可用性**: 使用者能在瀏覽器開啟 `index.html`，看到清晰的操作介面
- [ ] **啟動與停止**: 點擊「開始按摩」→ 選擇部位與強度 → 狀態轉為「按摩中」與倒數 → 手動停止或自動結束
- [ ] **事件儲存**: 按摩結束後，自動建立事件物件與寫入 GUN
- [ ] **同步狀態**: UI 顯示「同步中」/「同步成功」/「同步失敗」
- [ ] **分享與共享**: 家人能透過分享連結看到最新紀錄

### 測試驗收
- [ ] **測試檔案存在**: `tests.html` 與 `tests/tests.js` 已建立
- [ ] **測試通過**: 至少 3 個 Mocha 測試通過
  - 測試 1: 建立事件物件並驗證結構
  - 測試 2: 儲存到 GUN 後能讀取相同資料
  - 測試 3: UI 按鈕觸發狀態變更
- [ ] **測試涵蓋率**: 核心函式（啟動、停止、儲存、讀取）至少有 1 個測試

### 程式碼品質
- [ ] **無 npm 依賴**: 所有套件均使用 CDN
- [ ] **程式碼註解**: 關鍵函式與邏輯有清晰註解
- [ ] **無控制台錯誤**: 瀏覽器控制台無 JavaScript 錯誤

---

## 7. 技術選型

### 前端框架與套件
- **HTML/CSS/JS**: 純原生，無框架（React、Vue 等）
- **CDN 套件清單**:
  - **GUN.js**: 去中心化資料同步 (`https://cdn.jsdelivr.net/npm/gun/gun.js`)
  - **Mocha**: 測試框架 (`https://cdn.jsdelivr.net/npm/mocha/mocha.js`)
  - **Chai**: 斷言庫 (`https://cdn.jsdelivr.net/npm/chai/chai.js`)
  - **可選**: Bootstrap 或自訂 CSS（為簡潔起見，使用簡單自訂樣式）

### 資料模型 (GUN)

每次按摩事件記錄為：
```javascript
{
  id: "painEvent_1234567890",           // 唯一識別符
  timestamp: 1700000000,                 // Unix 時間戳
  location: "公園" 或自由文字,           // 地點
  painArea: "腰部" / "背部" / "肩頸",   // 疼痛部位
  intensity: 5,                          // 強度等級 (1-10)
  duration: 15,                          // 按摩時間（分鐘）
  notes: "使用者備註",                   // 可選備註
  deviceStatus: "已停止",                // 狀態
  syncStatus: "成功" / "失敗" / "中"    // 同步狀態
}
```

### 部署與執行
- **本地開發**: 直接用瀏覽器開啟 `index.html`（需網路連接以載入 CDN 與 GUN 同步）
- **部署**: 可放在任何靜態主機（GitHub Pages、Vercel、簡單 HTTP 伺服器等）
- **GUN 節點**: 預設使用公共 GUN 中繼節點（用戶也可自建私有節點）

---

## 8. TDD 開發流程

### 第一階段: 測試優先
1. 撰寫 `tests/tests.js`，包含 3 個基礎測試：
   - `test("建立事件物件")`: 驗證事件結構正確
   - `test("儲存與讀取")`: 驗證 GUN 同步
   - `test("UI 狀態切換")`: 驗證按鈕點擊後 UI 變化

2. 執行 `tests.html`，測試暫時失敗（紅色）

### 第二階段: 實作最小化功能
1. 在 `app.js` 實作必要函式：
   - `createPainEvent()`: 建立事件物件
   - `saveToGUN()`: 儲存到 GUN
   - `toggleMassageStatus()`: 切換按摩狀態

2. 執行測試，逐步推進至全部通過（綠色）

### 第三階段: 重構與優化
1. 改進程式碼可讀性、性能、註解
2. 補充邊界測試（例如無效輸入、連線失敗）
3. 確保測試仍全部通過（保持綠色）

### 反覆迭代
- 每新增一個功能，先寫測試，再實作程式碼，最後驗收

---

## 9. 風險與限制

### 已知限制
1. **硬體整合**: 本 prototype 不含真實按摩裝置的硬體通訊，只模擬狀態。未來可透過 WebBluetooth API 擴充。
2. **GUN 同步可見性**: GUN 去中心化特性意味著所有連線者可見資料。若需隱私保護，應實作加密或權限控制（超出本 MVP 範圍）。
3. **離線同步延遲**: 若使用者長期離線，重新連線後 GUN 會批量同步，可能產生延遲。
4. **瀏覽器相容性**: 依賴現代瀏覽器 API（例如 LocalStorage、Fetch、Promise），舊版 IE 不支援。

### 未來擴充方向
- [ ] 藍牙或 WebBluetooth 與真實按摩墊硬體整合
- [ ] 加密與身份驗證（保護隱私）
- [ ] 行動應用版（React Native 或 Flutter）
- [ ] 數據分析儀表板（趨勢圖表、醫療集成）
- [ ] 多語言支援（中文、英文、日文等）

---

## 10. 檔案結構

```
/workspaces/ah/
├── README.md              # 專案說明
├── PRD.md                 # 本文件
├── AGENTS.md              # 開發進度與接手指南
├── index.html             # 主應用頁面
├── styles.css             # 樣式表
├── app.js                 # 核心應用邏輯
├── tests.html             # 測試頁面 (Mocha)
└── tests/
    └── tests.js           # 單元測試程式碼
```

---

## 11. 成功指標

專案視為完成的條件：

✅ `PRD.md` 與 `AGENTS.md` 已確認  
✅ 前端可在瀏覽器開啟與互動  
✅ 至少 3 個 Mocha 測試通過  
✅ GUN.js 能正確儲存與同步事件  
✅ 分享連結可供他人查看紀錄  
✅ 無明顯 UI/UX 問題與控制台錯誤  

---

**最後更新**: 2025-11-19  
**版本**: 1.0 (MVP)  
**狀態**: 待開發
